---
title       : pitchRx 
subtitle    : Tools for Collecting and Visualizing MLB PITCHf/x Data
author      : Carson Sievert
job         : Department of Statistics, Iowa State University
framework   : io2012                          # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js                    # {highlight.js, prettify, highlight}
hitheme     : github                        # 
widgets     : [mathjax, bootstrap]            # {mathjax, quiz, bootstrap}
mode        : selfcontained                   # {standalone, draft}
---

## What is PITCHf/x?

<iframe src="http://www.sportvision.com/media/pitchfx"></iframe>

---
## PITCHf/x data format

<iframe src="http://gd2.mlb.com/components/game/mlb/year_2011/month_04/day_04/gid_2011_04_04_minmlb_nyamlb_1/inning/inning_all.xml"></iframe>

---
## My initial attempt at scraping PITCHf/x

<div align="center"><img src="http://i.imgur.com/Wum3mpD.png" height="550" width="800"/></div>

---
## Scraping made easy

```{r ex1, cache=TRUE, results='hide'}
library(pitchRx)
data <- scrapeFX(start="2011-04-04", end="2011-04-04")
str(data, list.len=5)
```

```{r head, echo=FALSE}
str(data, list.len=5)
```


---
## Devil's in the details

* Among many other things, this website hosts data on almost every pitch thrown since 2008.
* That's a lot of data! Since 2008, there was:
  * Over 14,000 games
  * Over 5,000 players (each player has a unique file for each game)
  * Over 1M atbats
  * Over 3.5M pitches
* Data is stored on multiple levels. The connections aren't always intuitive.

---
## Example data

We'll focus on fastballs thrown by Mariano Rivera and Phil Hughes in 2011:

```{r ex2, eval=FALSE}
atbats <- subset(data$atbat, pitcher_name %in% c("Mariano Rivera", "Phil Hughes"))
pitchFX <- join(atbats, data$pitch, by=c("num", "url"), type="inner")
pitches <- subset(pitchFX, pitch_type %in% c("FF", "FC"))
```

---
## Animation

```{r setup, include=FALSE}
opts_chunk$set(fig.path="figure/", cache.path="cache/", fig.align="center", warning=FALSE, message=FALSE, fig.height=10, fig.width=12)
opts_knit$set(animation.fun = hook_r2swf)
library(pitchRx)
data(pitches)
```

```{r ani, fig.show="animate", interval=0.01, cache=TRUE, dev="CairoPNG", echo=FALSE}
animateFX(pitches, point.size=5, layer=coord_equal())
```

---
## Easily add ggplot layers

```{r ani3, fig.show="animate", interval=0.01, cache=TRUE, dev="CairoPNG", echo=FALSE}
animateFX(pitches, point.size=5, layer=list(theme_bw(), coord_equal(), facet_grid(pitcher_name~stand, labeller = label_both)))
```

---

## WebGL graphics

```{r demo, echo=FALSE, eval=FALSE}
Rivera <- subset(pitches, pitcher_name=="Mariano Rivera")
interactiveFX(Rivera, interval=.05)
```

<iframe src="http://cpsievert.github.com/pitchRx/rgl1"></iframe>

---

## More WebGL

```{r demo2, echo=FALSE, eval=FALSE}
Rivera <- subset(pitches, pitcher_name=="Mariano Rivera")
interactiveFX(Rivera, color="type", alpha=.2)
```

<iframe src="http://cpsievert.github.com/pitchRx/rgl2"></iframe>

---
## Shiny

<iframe src="http://glimmer.rstudio.com/cpsievert/pitchRx"></iframe>

---
## Biased umpires?

* In many sports, people like to blame stuff on bad referees/umpires.

* In baseball, people love to speculate that umpires make decisions in favor of the home team.

* With PITCHf/x, we can examine evidence of any 'strikezone bias'.

<div align="center"><img src="http://i.imgur.com/0lNvqM8.jpg" height="450" width="800"/></div>

---
## Called strike

* A __called strike__ is a case where the batter does not swing and the umpire declares the pitch is within the strikezone (and thus, a strike). If the batter reaches three strikes during an atbat, he is out.

<div align="center"><img src="http://i.imgur.com/QfHfDM2.png" height="450" width="800"/></div>

---
## Every called strike!

<div align="center"><img src="http://i.imgur.com/bOa0gun.png" height="550" width="1000"/></div>

---
## Away called strikes minus home strikes

<div align="center"><img src="http://i.imgur.com/EMstIPZ.png" height="550" width="1000"/></div>

---
## Balls

* A __ball__ is an instance where the batter doesn't swing and the umpire declares the pitch is outside of the strikezone (and thus, a ball). If four balls are thrown during an atbat, the batter gets to freely reach base.

<div align="center"><img src="http://i.imgur.com/iodOiLM.jpg" height="450" width="800"/></div>

---
## Away balls minus home balls

<div align="center"><img src="http://i.imgur.com/Fe4Monz.png" height="550" width="1000"/></div>

